{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        .download-btn {
            padding: 10px 20px;
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin: 11px auto;
            cursor: pointer;
            border-radius: 16px;
        }

        .download-btn:hover {
            background-color: #45a049;
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <!-- <script src="{% static 'js/chart.js' %}"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
</head>

<body>
    <div class="container">
        <aside>
            <div class="top">
                <div class="logo">
                    <img src="{% static 'images/logo1.png' %}" alt="Logo">
                    <h2>Ad<span class="topc">min</span></h2>
                </div>
                <div class="close" id="c-btn">
                    <span class="material-icons-sharp">
                        close
                    </span>
                </div>
            </div>
            <div class="sidebar">
                <a href="#" class="active">
                    <span class="material-icons-sharp">
                        grid_view
                    </span>
                    <h3>Dashboard</h3>
                </a>
                <a href="{% url 'view_complains' %}">
                    <span class="material-icons-sharp">
                        person_outline
                    </span>
                    <h3>Complains</h3>
                </a>
                <a href="#">
                    <span class="material-icons-sharp">
                        receipt_long
                    </span>
                    <h3>FIRs</h3>
                </a>
                {% if is_superuser %}
                <a href="{% url 'login_activity' %}">
                    <span class="material-icons-sharp">
                        manage_accounts
                    </span>
                    <h3>Login Activity</h3>
                </a>
                <a href="{% url 'user_list' %}">
                    <span class="material-icons-sharp">
                        supervisor_account
                    </span>
                    <h3>Manage Users</h3>
                </a>
                {% endif %}
                <a href="{% url 'logout' %}">
                    <span class="material-icons-sharp">
                        logout
                    </span>
                    <h3>Logout</h3>
                </a>
            </div>
        </aside>
        <main>
            <h1>Dashboard</h1>
            <div class="date"><input type="date" id="todaydate" value=""><span id="currentTime"></span></div>
            <div class="insights">
                <div class="cases">
                    <span class="material-icons-sharp">analytics</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Total Cases</h3>
                            <h1>{{ total_cases }} </h1>
                            <button class="download-btn1 download-btn" onclick="downloadData('total_cases')">Download</button>
                        </div>
                    </div>
                </div>
                <div class="closed">
                    <span class="material-icons-sharp">analytics</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Closed Cases</h3>
                            <h1>{{closed_cases}}</h1>
                            <button class="download-btn2 download-btn" onclick="downloadData('closed_cases')">Download</button>
                        </div>
                    </div>
                </div>
                <div class="today">
                    <span class="material-icons-sharp">analytics</span>
                    <div class="middle">
                        <div class="left">
                            <h3>Registered Today</h3>
                            <h1>{{registered_today}}</h1>
                            <button class="download-btn3 download-btn" onclick="downloadData('registered_today')">Download</button>
                        </div>

                    </div>
                
                </div>
                
            </div>
            <div class="graph1">
                <canvas id="last-week-chart" width="400" height="200"></canvas>
            </div>
            <div class="recent-complains">
                
                <h2>Recent Complains</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Ack</th>
                            <th>Name</th>
                            <th>Fraud Type</th>
                            <th>Steps Taken</th>
                            <th>Status</th>
                        </tr>

                    </thead>
                    <tbody>
                        {% for complain in complains %}
                        <tr>
                            <td>{{ complain.Date }}</td>
                            <td>{{ complain.ack_number }}</td>
                            <td>{{ complain.name }}</td>
                            <td>{{ complain.fraud_type }}</td>
                            <td>{{ complain.steps_taken }}</td>
                            <td>{{ complain.status }}</td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>

        </main>
        <div class="right">
            <div class="top">
                <button id="menu-btn">
                    <span class="material-icons-sharp">menu</span>
                </button>
                <div class="theme-toggler">
                    <span class="material-icons-sharp active">light_mode</span>
                    <span class="material-icons-sharp">dark_mode</span>
                </div>
                <div class="profile">
                    <div class="info">
                        <p>Welcome, <b>Sidharth</b></p>
                        <small class="text-muted">Admin</small>
                    </div>
                    <div class="profile-photo">
                        <img src="{% static 'images/profile_image.jpg' %}" alt="Profile Photo">
                    </div>
                </div>
            </div>
            <div class="recent-updates">
                <!-- <h2>Recent Updates</h2> -->
                     
                    <div class="updates">
                        <canvas id="statusPieChart" width="400" height="200"></canvas>
                        <!-- <select id="timeRange">
                            <option value="all">All</option>
                            <option value="lastYear">Last 1 Year</option>
                            <option value="lastTwoYears">Last 2 Years</option>
                            <option value="lastSixMonths">Last 6 Months</option>
                        </select> -->
                    </div>
             

                <!-- <div class="updates">
                    <div class="update">
                        <div class="profile-photo">
                            <img src="profile_image.jpg" alt="">
                        </div>
                        <div class="messages">
                            <p><b>Aryan Dash</b> Added ack number 4</p>
                            <div class="text-muted">2 Minutes Ago</div>
                        </div>
                    </div>
                    <div class="update">
                        <div class="profile-photo">
                            <img src="profile_image.jpg" alt="">
                        </div>
                        <div class="messages">
                            <p><b>Aryan Dash</b>added ack number 4</p>
                            <div class="text-muted">2 Minutes Ago</div>
                        </div>
                    </div>
                    <div class="update">
                        <div class="profile-photo">
                            <img src="profile_image.jpg" alt="">
                        </div>
                        <div class="messages">
                            <p><b>Aryan Dash</b>added ack number 4</p>
                            <div class="text-muted">2 Minutes Ago</div>
                        </div>
                    </div>
                    <div class="update">
                        <div class="profile-photo">
                            <img src="profile_image.jpg" alt="">
                        </div>
                        <div class="messages">
                            <p><b>Aryan Dash</b>added ack number 4</p>
                            <div class="text-muted">2 Minutes Ago</div>
                        </div> -->

                    <!-- </div> -->

                </div>

            </div>
            
        </div>
    </div>

    <script src="{% static 'js/admin_dashboard.js' %}"></script>
    <script>
        var chartData = {{ chart_data|safe }};
        var ctx = document.getElementById('last-week-chart').getContext('2d');
        var complaintsChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: 'Complaints Registered',
                    data: chartData.data,
                    // borderColor: 'rgba(75, 192, 192, 1)',
                    // backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    // borderWidth: 1,
                    fill: true,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
                pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                pointBorderColor: '#fff',
                pointBorderWidth: 0.4,
                pointRadius: 5,
                pointHoverRadius: 8
                }]
            },
            // options: {
            //     responsive: true,
            //     scales: {
            //         y: {
            //             beginAtZero: true
            //         }
            //     }
            // }
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Date',
                            color: '#333',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        }
                    },
                    y: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Number of Cases',
                            color: '#333',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        beginAtZero:true
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                },
                animation: {
                    duration: 1000,
                    easing: 'easeInOutQuart' 
                }
            }
        });


        // function fetchPieChartData(timeRange) {
        // return fetch(`http://127.0.0.1:8000/ComplainApp/admin/get_pie_chart_data/${timeRange}/`)
        // .then(response => response.json())
        // .then(data => data)
        // .catch(error => console.error('Error fetching data:', error));
// }
        var pieChartData = {{ pie_chart_data|safe }};
        // let pieChartData = fetchPieChartData('all');
        var ctxPie = document.getElementById('statusPieChart').getContext('2d');
        var customLabels = [
            'Open',
            'In Review',
            'Visit Police Station',
            'In Progress',
            'Closed (Reach out to Police Station)'
        ];
        var statusPieChart = new Chart(ctxPie, {
            type: 'pie',
        //     data: {
        //         labels: pieChartData.labels,
        //         datasets: [{
        //             data: pieChartData.data,
        //             backgroundColor: [
        //                 'rgba(255, 99, 132, 0.2)',
        //                 'rgba(54, 162, 235, 0.2)',
        //                 'rgba(255, 206, 86, 0.2)',
        //                 'rgba(75, 192, 192, 0.2)',
        //                 'rgba(153, 102, 255, 0.2)',
        //                 'rgba(255, 159, 64, 0.2)'
        //             ],
        //             borderColor: [
        //                 'rgba(255, 99, 132, 1)',
        //                 'rgba(54, 162, 235, 1)',
        //                 'rgba(255, 206, 86, 1)',
        //                 'rgba(75, 192, 192, 1)',
        //                 'rgba(153, 102, 255, 1)',
        //                 'rgba(255, 159, 64, 1)'
        //             ],
        //             borderWidth: 2
        //         }]
        //     },
        //     options: {
        //         responsive: true
        //     }
        // });

        
        data: {
                // labels: pieChartData.labels,
                labels: customLabels,
                datasets: [{
                    data: pieChartData.data,
                    backgroundColor: [
                        '#FF6384', // Red
                        '#36A2EB', // Blue
                        '#FFCE56', // Yellow
                        '#4BC0C0', // Teal
                        '#9966FF', // Purple
                        '#FF9F40'  // Orange
                    ],
                    
                    borderColor: [
                        'white',
                        'white',
                        'white',
                        'white',
                        'white',
                        'white',
                        // '#36A2EB',
                        // '#FFCE56',
                        // '#4BC0C0',
                        // '#9966FF',
                        // '#FF9F40'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                var label = pieChartData.labels[tooltipItem.dataIndex] || '';
                                var value = pieChartData.data[tooltipItem.dataIndex] || 0;
                                return label + ': ' + value.toFixed(2) + '%';
                            }
                        }
                    },
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            pointStyle: 'circle',
                            padding: 10
                        }
                    },
                    title: {
                        display: true,
                        text: 'Case Status Distribution',
                        font: {
                            size: 18,
                            color: 'black'
                        }
                    }
                }
            }
        });

    //     document.getElementById('timeRange').addEventListener('change', function() {
    // let selectedRange = this.value;
    // fetchPieChartData(selectedRange).then(updatedData => {
    //     statusPieChart.data.labels = updatedData.labels;
    //     statusPieChart.data.datasets[0].data = updatedData.data;
    //     statusPieChart.update();
    // });
// });

    </script>
</body>

</html>













